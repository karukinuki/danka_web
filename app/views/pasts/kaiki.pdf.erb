<%= stylesheet_link_tag 'kaiki' %>
<main class="kaiki" style="orientation: 'Landscape'">
  <div class="k-head">
    <h1>年忌<span class="nono">の</span>お知らせ</h1>
  </div>
  <span class="js-span-wrap-text">ああああああああああああああああああああ</span>
  <div class="k-main">
    <div class="">
      <div class="">
        合掌
      </div>
      <div class="">
        <p class="k-indent">季節の挨拶季節の挨拶季節の挨拶季節の挨拶<br>季節の挨拶季節の挨拶季節の挨拶
          季節の挨拶季節の挨拶季節の挨拶季節の挨拶季節の挨拶<br>季節の挨拶季節の挨拶季節の挨拶季節の挨拶
          季節の挨拶季節の挨拶季節の挨拶季節の挨拶季節の挨拶季節の挨拶季節の挨拶季節の挨拶<br>
          さて、
        </p>
        <div class="k-line">
          <span><%= Time.current.year %>年</span>
          <span><%= @past.deathday.month %>月<%= @past.deathday.day %>日</span><br>
          <span class="k-big">法名<%= @past.penname %></span><br>
          <span><%= @past.name %></span>様の
          <span>
            <% if @current - @death == 1 %>
              壱周忌
            <% elsif @current - @death == 2 %>
              参回忌
            <% elsif @current - @death == 6 %>
              七回忌
            <% elsif @current - @death == 12 %>
              十三回忌
            <% else @current - @death == 22 %>
              二十三回忌
            <% end %>
          </span>が参ります。
        </div>
        <br>
        法事をお考えの場合はご都合の良い日をお知らせください。<br>
        早めに連絡いただきますとご希望の時間が<br>とりやすくなりますので、お早めにご連絡ください。
      </div>
    </div>
  </div>
  <div class="k-end">
    <div class="k-big">
      お寺の名前
    </div>
    <div class="k-address">
      <div class="">
        山梨県　富士吉田市　
      </div>
      <div class="">
        電話番号:０１９２８２１１８０２１
        <br>
        FAX：８１９７３４５９４７１３８９
      </div>
    </div>
  </div>
</main>

<script>
  class SpanWrap {
    constructor() {
      this.settings = {
        target: ".js-span-wrap-text"
      }
      this.targets = "";
      this.targetLength = 0;
      this.nodes = [];
      this.convertContents = [];
    }

    init(options) {
      this.setup(options);
      this.getNodes();
      this.convert();
      this.set();
    }

    setup(options) {
      this.settings = Object.assign({
        target: this.settings.target
      }, options || {});
      this.targets = document.querySelectorAll(this.settings.target);
      this.targetLength = this.targets.length;
    }

    getNodes() {
      for (let target of this.targets) {
        let nodes = target.childNodes;
        this.nodes.push(nodes);
      }
    }

    convert() {
      for (let i = 0; i < this.targetLength; i++) {
        this.convertContents.push([]);//カラの配列を追加
        for (let node of this.nodes[i]) {
          if (node.nodeType == 3) {//テキストの場合
            let text = node.textContent.replace(/\s+/g, '');//テキストから空白削除
            text.split('').forEach((v) => {
              this.convertContents[i].push("<span>" + v + "</span>");
            });

          } else {//テキスト以外
            this.convertContents[i].push(node.outerHTML);
          }
        }
      }
    }

    set() {
      for (let i = 0; i < this.targetLength; i++) {
        this.targets[i].innerHTML = this.convertContents[i].join("");
      }
    }

  }
  const spanWrap = new SpanWrap();
  spanWrap.init();
spanWrap.init();
</script>
